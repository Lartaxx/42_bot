"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Command = void 0;
const discord_js_1 = require("discord.js");
const _1 = require(".");
const constants_1 = require("../constants/constants");
/**
 * Represents an Command structure
 * @extends {BaseStructure}
 */
class Command extends _1.BaseStructure {
    /**
     * Constructor for build a Command
     * @param {ShewenyClient} client Client framework
     * @param {CommandData} data Data for build a Command
     */
    constructor(client, data) {
        super(client);
        const defaultData = client.managers.commands?.default;
        const type = data.type || defaultData.type;
        this.adminsOnly = data.adminsOnly || defaultData.adminOnly;
        this.aliases = this.isType(type, constants_1.COMMAND_TYPE.cmdMsg) ? data.aliases : [];
        this.args = this.isType(type, constants_1.COMMAND_TYPE.cmdMsg) ? data.args : undefined;
        this.category = data.category || defaultData.category;
        this.channel = data.channel || defaultData.channel;
        this.clientPermissions = data.clientPermissions || defaultData.clientPermissions;
        this.cooldown = data.cooldown || defaultData.cooldown;
        this.cooldowns = new discord_js_1.Collection();
        this.defaultPermission = this.isType(type, constants_1.COMMAND_TYPE.cmdSlash, constants_1.COMMAND_TYPE.ctxUser, constants_1.COMMAND_TYPE.ctxMsg)
            ? data.defaultPermission
            : undefined;
        this.description = data.description || '';
        this.examples = data.examples || defaultData.examples;
        this.manager = this.client.managers.commands;
        this.name = data.name;
        this.options = this.isType(type, constants_1.COMMAND_TYPE.cmdSlash) ? data.options : undefined;
        this.type = data.type || defaultData.type;
        this.usage = data.usage || defaultData.usage;
        this.userPermissions = data.userPermissions || defaultData.userPermissions;
    }
    /**
     * Unregister a command from collections
     * @returns {boolean}
     */
    unregister() {
        this.client.collections.commands?.delete(this.name);
        delete require.cache[require.resolve(this.path)];
        return true;
    }
    /**
     * Reload a command
     * @returns {Promise<Collection<string, Command> | null>} The Application Commands collection
     */
    async reload() {
        if (this.path) {
            this.unregister();
            return this.register();
        }
        return null;
    }
    /**
     * Register a command in collections
     * @returns {Collection<string, ApplicationCommand>} The Application Commands collection
     */
    async register() {
        const Command = (await Promise.resolve().then(() => require(this.path))).default;
        const AC = new Command(this.client);
        return this.client.collections.commands
            ? this.client.collections.commands.set(AC.name, AC)
            : new discord_js_1.Collection().set(AC.name, AC);
    }
    isType(type, ...types) {
        if (types.includes(type))
            return true;
        return false;
    }
}
exports.Command = Command;
